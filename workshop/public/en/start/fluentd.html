<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="ANT332 AWS re:Invent 2019" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="generator" content="Hugo 0.60.0" />
  <meta name="description" content="ANT332 AWS re:Invent 2019">
<meta name="author" content="Saad Rana, Anoop Sunke">

  <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />

  <title>Fluentd 101 :: ANT332 AWS re:Invent 2019</title>

  
  <link href="../../css/nucleus.css" rel="stylesheet">
  <link href="../../css/fontawesome-all.min.css" rel="stylesheet">
  <link href="../../css/hybrid.css" rel="stylesheet">
  <link href="../../css/featherlight.min.css" rel="stylesheet">
  <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
  <link href="../../css/auto-complete.css" rel="stylesheet">
  <link href="../../css/atom-one-dark-reasonable.css" rel="stylesheet">
  <link href="../../css/theme.css" rel="stylesheet">
  <link href="../../css/hugo-theme.css" rel="stylesheet">
  
  <link href="../../css/theme-aws.css" rel="stylesheet">
  

  <script src="../../js/jquery-3.3.1.min.js"></script>

  <style>
    :root #header + #content > #left > #rlblock_left{
        display:none !important;
    }
    
      :not(pre) > code + span.copy-to-clipboard {
          display: none;
      }
    
  </style>
  
</head>

<body class="" data-url="/en/start/fluentd.html">
  <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
    <a href="../../" title="Go home">
        <img style="vertical-align:middle" src="../../images/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js"></script>
<script type="text/javascript" src="../../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "\/en";
    
</script>
<script type="text/javascript" src="../../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/en/intro.html" title="Service Overview" class="dd-item 
        
        
        
        ">
      <a href="../../en/intro.html">
          <b>1. </b>Service Overview
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/intro/first-content.html" title="What is Amazon Elasticsearch?" class="dd-item ">
        <a href="../../en/intro/first-content.html">
        What is Amazon Elasticsearch?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/intro/second-content.html" title="What is Amazon EKS?" class="dd-item ">
        <a href="../../en/intro/second-content.html">
        What is Amazon EKS?
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/kube101.html" title="Kubernetes 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/kube101.html">
          <b>2. </b>Kubernetes 101
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/monkube.html" title="Monitoring Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="../../en/monkube.html">
          <b>3. </b>Monitoring Kubernetes
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/pipe1.html" title="Data pipeline 1:  Beats and Logstash" class="dd-item 
        
        
        
        ">
      <a href="../../en/pipe1.html">
          <b>4. </b>Data pipeline 1:  Beats and Logstash
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/pipe2.html" title="Data pipeline 2: Fluentd and Fluentbit" class="dd-item 
        
        
        
        ">
      <a href="../../en/pipe2.html">
          <b>5. </b>Data pipeline 2: Fluentd and Fluentbit
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/start.html" title="Let the lab begin!" class="dd-item 
        parent
        
        
        ">
      <a href="../../en/start.html">
          <b>6. </b>Let the lab begin!
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/start/setup.html" title="Lab Setup and Login to AWS" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/setup.html">
          Lab Setup and Login to AWS
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/monitoring.html" title="What we are monitoring" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/monitoring.html">
          What we are monitoring
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/gettingfamiliar.html" title="Get familiar with lab environment" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/gettingfamiliar.html">
          Get familiar with lab environment
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/configcloud9.html" title="Configure Cloud9 IDE" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/configcloud9.html">
          Configure Cloud9 IDE
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deployguest.html" title="Deploy guestbook application" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/deployguest.html">
          Deploy guestbook application
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/configkibana.html" title="Configure Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/configkibana.html">
          Configure Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deploylogstash.html" title="Deploying Logstash" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/deploylogstash.html">
          Deploying Logstash
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/filebeat.html" title="Filebeat 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/filebeat.html">
          Filebeat 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/metricbeat.html" title="Metricbeat 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/metricbeat.html">
          Metricbeat 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/viewmetrics.html" title="View Metricbeat data in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/viewmetrics.html">
          View Metricbeat data in Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentd.html" title="Fluentd 101" class="dd-item 
        parent
        active
        
        ">
      <a href="../../en/start/fluentd.html">
          Fluentd 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentbit.html" title="What is Fluentbit and how is it different?" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/fluentbit.html">
          What is Fluentbit and how is it different?
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentsidecar.html" title="Fluentbit deployment as a &#39;Sidecar&#39;" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/fluentsidecar.html">
          Fluentbit deployment as a &#39;Sidecar&#39;
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deployfluent.html" title="Deploying Fluentd and Fluentbit" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/deployfluent.html">
          Deploying Fluentd and Fluentbit
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/indices.html" title="Configuring Index Patterns in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/indices.html">
          Configuring Index Patterns in Kibana
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/k8s.html" title="Configure Kibana for Kubernetes Index" class="dd-item ">
        <a href="../../en/start/indices/k8s.html">
        <b>1. </b>Configure Kibana for Kubernetes Index
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/redis.html" title="Configure Kibana for redis index" class="dd-item ">
        <a href="../../en/start/indices/redis.html">
        <b>2. </b>Configure Kibana for redis index
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/apache.html" title="Configure Kibana for apache index" class="dd-item ">
        <a href="../../en/start/indices/apache.html">
        <b>3. </b>Configure Kibana for apache index
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/explorekibana.html" title="Explore data in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/explorekibana.html">
          Explore data in Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/mysteryhunt.html" title="Mystery hunt exercise" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/mysteryhunt.html">
          Mystery hunt exercise
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt1.html" title="Mystery hunt 1" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt1.html">
        <b>1. </b>Mystery hunt 1
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt2.html" title="Mystery hunt 2" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt2.html">
        <b>2. </b>Mystery hunt 2
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt3.html" title="Mystery hunt 3" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt3.html">
        <b>3. </b>Mystery hunt 3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/appendix.html" title="Appendix" class="dd-item 
        
        
        
        ">
      <a href="../../en/appendix.html">
          <b>7. </b>Appendix
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/en/start/fluentd.html" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <h5 class="copyright">&copy; 2019 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>

</left>

    </section>
  </div>
</nav>





  <section id="body">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        <div id="top-bar">
          
          
          <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='../../en/'>Use Amazon ES to visualize and monitor containerized applications</a> > <a href='../../en/start.html'>Let the lab begin!</a> > Fluentd 101
          
          
          
          
          
          
            </span>
          </div>
          
          <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

          
        </div>
      </div>
      

      
        <div id="body-inner">
          <h1>Fluentd 101</h1>
          
          



	<p>Fluentd is a fully free and fully open-source log collector that instantly enables you to have a &lsquo;Log Everything&rsquo; architecture with 600+ types of systems.Fluentd treats logs as JSON, a popular machine-readable format. It is written primarily in C with a thin-Ruby wrapper that gives users flexibility.</p>
<p><img src="https://ant332.s3-us-west-2.amazonaws.com/ant332-lab-guide-artifacts/fluentd-architecture.png" alt="alt"></p>
<p>Fluentd has the following key components - Setup, Inputs, Filters, Parsers and Outputs. You can find the these configurations under <code>values.yml</code> file under <code>fluentd-elasticsearch</code> folder. We use Fluentd to collect and process multiple sources of logs such as apache logs, kubelet, kube-api-server and more.</p>
<h4 id="setup">Setup</h4>
<p>The configuration files is the fundamental piece to connect all things together, as it allows to define which Inputs or listeners Fluentd will have and set up common matching rules to route the Event data to a specific Output.</p>
<h4 id="input">Input</h4>
<p>Extend Fluentd to retrieve and pull event logs from external sources. An input plugin typically creates a thread socket and a listen socket. It can also be written to periodically pull data from data sources.</p>
<p>In this snippet below the input plugin is configured to tail and collect Apache access logs that are in json format.</p>
<pre><code>&lt;source&gt;
  @type tail
  path /var/log/containers/*frontend*.log
  pos_file /var/log/apache-access.log.pos
  format json
  tag apache.access
  ....
&lt;/source&gt;
</code></pre><h4 id="parser">Parser</h4>
<p>Fluentd has a pluggable system that enables the user to create their own parser formats. In the code snippet below, we are using the out-of-the-box <code>apache2</code> parser to parse the access logs. To parse custom logs, you can leverage <code>regexp</code> to support regex parsing.</p>
<pre><code>  &lt;filter apache.access&gt;
     @type parser
     key_name log
     format apache2
     ....
   &lt;/filter&gt;
</code></pre><h4 id="output">Output</h4>
<p>This plugin allows you write data to various output destinations.
In the code snippet below the output is configured to Elasticsearch endpoint and port. With this <code>logstash_format</code> set true, Fluentd uses the conventional index name format logstash-%Y.%m.%d.</p>
<p>Fluentd can also buffer data, in this case we are leverage disk based persistent buffering set by <code>@type file</code> setting.</p>
<pre><code>&lt;match apache.**&gt;
      @type elasticsearch
      host &quot;#{ENV['OUTPUT_HOST']}&quot;
      port &quot;#{ENV['OUTPUT_PORT']}&quot;
      logstash_prefix apache
      logstash_format true
      &lt;buffer&gt;
        @type file
        path /var/log/fluentd-buffers/apache.system.buffer
        flush_mode interval
        ....
      &lt;/buffer&gt;
    &lt;/match&gt;
</code></pre>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../en/start/viewmetrics.html" title="View Metricbeat data in Kibana"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../en/start/fluentbit.html" title="What is Fluentbit and how is it different?" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js"></script>
    <script src="../../js/perfect-scrollbar.min.js"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../../js/jquery.sticky.js"></script>
    <script src="../../js/featherlight.min.js"></script>
    <script src="../../js/html5shiv-printshiv.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js"></script>
    <script src="../../js/learn.js"></script>
    <script src="../../js/hugo-learn.js"></script>

    <link href="../../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
  </body>
</html>

