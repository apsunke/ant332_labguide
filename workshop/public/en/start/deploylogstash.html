<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="ANT332 AWS re:Invent 2019" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="generator" content="Hugo 0.60.0" />
  <meta name="description" content="ANT332 AWS re:Invent 2019">
<meta name="author" content="Saad Rana, Anoop Sunke">

  <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />

  <title>Deploying Logstash :: ANT332 AWS re:Invent 2019</title>

  
  <link href="../../css/nucleus.css" rel="stylesheet">
  <link href="../../css/fontawesome-all.min.css" rel="stylesheet">
  <link href="../../css/hybrid.css" rel="stylesheet">
  <link href="../../css/featherlight.min.css" rel="stylesheet">
  <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
  <link href="../../css/auto-complete.css" rel="stylesheet">
  <link href="../../css/atom-one-dark-reasonable.css" rel="stylesheet">
  <link href="../../css/theme.css" rel="stylesheet">
  <link href="../../css/hugo-theme.css" rel="stylesheet">
  
  <link href="../../css/theme-aws.css" rel="stylesheet">
  

  <script src="../../js/jquery-3.3.1.min.js"></script>

  <style>
    :root #header + #content > #left > #rlblock_left{
        display:none !important;
    }
    
      :not(pre) > code + span.copy-to-clipboard {
          display: none;
      }
    
  </style>
  
</head>

<body class="" data-url="/en/start/deploylogstash.html">
  <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
    <a href="../../" title="Go home">
        <img style="vertical-align:middle" src="../../images/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js"></script>
<script type="text/javascript" src="../../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "\/en";
    
</script>
<script type="text/javascript" src="../../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/en/intro.html" title="Service Overview" class="dd-item 
        
        
        
        ">
      <a href="../../en/intro.html">
          <b>1. </b>Service Overview
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/intro/first-content.html" title="What is Amazon Elasticsearch?" class="dd-item ">
        <a href="../../en/intro/first-content.html">
        What is Amazon Elasticsearch?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/intro/second-content.html" title="What is Amazon EKS?" class="dd-item ">
        <a href="../../en/intro/second-content.html">
        What is Amazon EKS?
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/kube101.html" title="Kubernetes 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/kube101.html">
          <b>2. </b>Kubernetes 101
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/monkube.html" title="Monitoring Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="../../en/monkube.html">
          <b>3. </b>Monitoring Kubernetes
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/pipe1.html" title="Data pipeline 1:  Beats and Logstash" class="dd-item 
        
        
        
        ">
      <a href="../../en/pipe1.html">
          <b>4. </b>Data pipeline 1:  Beats and Logstash
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/pipe2.html" title="Data pipeline 2: Fluentd and Fluentbit" class="dd-item 
        
        
        
        ">
      <a href="../../en/pipe2.html">
          <b>5. </b>Data pipeline 2: Fluentd and Fluentbit
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/start.html" title="Let the lab begin!" class="dd-item 
        parent
        
        
        ">
      <a href="../../en/start.html">
          <b>6. </b>Let the lab begin!
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/start/setup.html" title="Lab Setup and Login to AWS" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/setup.html">
          Lab Setup and Login to AWS
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/monitoring.html" title="What we are monitoring" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/monitoring.html">
          What we are monitoring
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/gettingfamiliar.html" title="Get familiar with lab environment" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/gettingfamiliar.html">
          Get familiar with lab environment
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/configcloud9.html" title="Configure Cloud9 IDE" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/configcloud9.html">
          Configure Cloud9 IDE
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deployguest.html" title="Deploy guestbook application" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/deployguest.html">
          Deploy guestbook application
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/configkibana.html" title="Configure Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/configkibana.html">
          Configure Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deploylogstash.html" title="Deploying Logstash" class="dd-item 
        parent
        active
        
        ">
      <a href="../../en/start/deploylogstash.html">
          Deploying Logstash
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/filebeat.html" title="Filebeat 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/filebeat.html">
          Filebeat 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/metricbeat.html" title="Metricbeat 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/metricbeat.html">
          Metricbeat 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/viewmetrics.html" title="View Metricbeat data in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/viewmetrics.html">
          View Metricbeat data in Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentd.html" title="Fluentd 101" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/fluentd.html">
          Fluentd 101
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentbit.html" title="What is Fluentbit and how is it different?" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/fluentbit.html">
          What is Fluentbit and how is it different?
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/fluentsidecar.html" title="Fluentbit deployment as a &#39;Sidecar&#39;" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/fluentsidecar.html">
          Fluentbit deployment as a &#39;Sidecar&#39;
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/deployfluent.html" title="Deploying Fluentd and Fluentbit" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/deployfluent.html">
          Deploying Fluentd and Fluentbit
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/indices.html" title="Configuring Index Patterns in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/indices.html">
          Configuring Index Patterns in Kibana
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/k8s.html" title="Configure Kibana for Kubernetes Index" class="dd-item ">
        <a href="../../en/start/indices/k8s.html">
        <b>1. </b>Configure Kibana for Kubernetes Index
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/redis.html" title="Configure Kibana for redis index" class="dd-item ">
        <a href="../../en/start/indices/redis.html">
        <b>2. </b>Configure Kibana for redis index
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/indices/apache.html" title="Configure Kibana for apache index" class="dd-item ">
        <a href="../../en/start/indices/apache.html">
        <b>3. </b>Configure Kibana for apache index
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/explorekibana.html" title="Explore data in Kibana" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/explorekibana.html">
          Explore data in Kibana
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/start/mysteryhunt.html" title="Mystery hunt exercise" class="dd-item 
        
        
        
        ">
      <a href="../../en/start/mysteryhunt.html">
          Mystery hunt exercise
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt1.html" title="Mystery hunt 1" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt1.html">
        <b>1. </b>Mystery hunt 1
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt2.html" title="Mystery hunt 2" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt2.html">
        <b>2. </b>Mystery hunt 2
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/start/mysteryhunt/hunt3.html" title="Mystery hunt 3" class="dd-item ">
        <a href="../../en/start/mysteryhunt/hunt3.html">
        <b>3. </b>Mystery hunt 3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/appendix.html" title="Appendix" class="dd-item 
        
        
        
        ">
      <a href="../../en/appendix.html">
          <b>7. </b>Appendix
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/en/start/deploylogstash.html" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <h5 class="copyright">&copy; 2019 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>

</left>

    </section>
  </div>
</nav>





  <section id="body">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        <div id="top-bar">
          
          
          <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='../../en/'>Use Amazon ES to visualize and monitor containerized applications</a> > <a href='../../en/start.html'>Let the lab begin!</a> > Deploying Logstash
          
          
          
          
          
          
            </span>
          </div>
          
          <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

          
        </div>
      </div>
      

      
        <div id="body-inner">
          <h1>Deploying Logstash</h1>
          
          



	<p>Logstash is an open source data collection engine with real-time pipelining capabilities. Logstash can dynamically unify data from disparate sources and normalize the data into destinations of your choice. Cleanse and democratize all your data for diverse advanced downstream analytics and visualization use cases.</p>
<p>A Logstash pipeline has three key elements <strong>inputs, filters and outputs</strong>. The input plugins consume data from a source, the filter plugins modify the data as you specify, and the output plugins write the data to a destination.</p>
<p>In this lab we built the following pipeline to parse filebeat, metricbeat data and output to Amazon ES. This Logstash pipeline (snippet below) listens for logs from filebeat on the worker nodes and metricbeat on both workers nodes and pods, parses the incoming filebeat log message using a <code>grok</code> filter as a regex. Metricbeat logs don't contain log messages so we are not using any field parsing for them. If the incoming log contains tags called either <code>filebeat</code> or <code>metricbeat</code> it pushes the log to the appropriate index in Elasticsearch as output.</p>
<p>In a second filter plugin we do a timestamp match using the <code>date</code> filter plugin, which reconciles Elasticsearch's default <code>@timestamp</code> field against the actual timestamp in the log file. This is done for both filebeat and metricbeat logs.</p>
<p>We can make changes to this config based on the type of logging we're doing. Below is a snippet from the Logstash config file for your reference. Review the config and move on to the next step.</p>
<pre><code>    input {
      beats {
        port =&gt; 5044
      }
    }

    filter {
      if &quot;filebeat&quot; in [tags] {
        grok {
            match =&gt; {
                &quot;message&quot; =&gt; '(?&lt;timestamp&gt;\S+\s\d+\s\S+)\s(?&lt;hostname&gt;\S+)\s(?&lt;log_message&gt;.*)'
            }
            add_tag =&gt; [ &quot;parsed_msg&quot; ]
        }
        date {
          match =&gt; [&quot;timestamp&quot;, &quot;MMM dd HH:mm:ss&quot;]
          target =&gt; &quot;@timestamp&quot;
          add_tag =&gt; [ &quot;parsed_time&quot; ]
        }
      }
      else if &quot;metricbeat&quot; in [tags] {
        date {
          match =&gt; [&quot;timestamp&quot;, &quot;MMM dd HH:mm:ss&quot;]
          target =&gt; &quot;@timestamp&quot;
          add_tag =&gt; [ &quot;parsed_time&quot; ]
        }
      }
    }

    output {
      if &quot;filebeat&quot; in [tags] {
        elasticsearch {
          hosts =&gt; [&quot;${ES_DOMAIN}&quot;]
          index =&gt; &quot;filebeat-%{+yyyy.MM.dd.HH}&quot;
        }
      }
      else if &quot;metricbeat&quot; in [tags] {
        elasticsearch {
          hosts =&gt; [&quot;${ES_DOMAIN}&quot;]
          index =&gt; &quot;metricbeat-%{+yyyy.MM.dd.HH}&quot;
        }
      }
    }
</code></pre><p>Navigate to the <code>logstash-manifests</code> directory under <code>ant332/final-deploy</code> (this should be your current working directory) folder by using the following command:</p>
<pre><code>cd /home/ec2-user/environment/ant332/final-deploy/logstash-manifests
</code></pre><p>First we need to update the <code>logstash-deployment.yml</code> with our Elasticsearch endpoint's address, for this run the following command. Replace the <code>&lt;OutputFromNestedESStack&gt;</code> with the Elasticsearch endpoint the Cloud9 setup step. Replace the <code>&lt;OutputFromNestedESStack&gt;</code> with the Elasticsearch endpoint the Cloud9 setup step.</p>
<pre><code>chmod +x deploy-logstash.sh
./deploy-logstash.sh https://&lt;OutputFromNestedESStack&gt;:443
</code></pre><p>Note down the Logstash IP address, going forward we will refer to this as <code>logsash_ip_address</code>.</p>
<p><img src="https://ant332.s3-us-west-2.amazonaws.com/ant332-lab-guide-artifacts/logstash-ip.png" alt=""></p>
<p>Incase the aforementioned command did not provide the logstash IP, usually due to a small delay in logstash becoming available, run the following command:</p>
<pre><code>kubectl -n logstash get pod -oyaml | yq r - 'items[0].status.podIP'
</code></pre><p>You can view the pod's readiness state by running the following command. You will notice logstash pods in running state.</p>
<pre><code>kubectl -n logstash get pods
</code></pre><p>Move on to the next step.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../en/start/configkibana.html" title="Configure Kibana"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../en/start/filebeat.html" title="Filebeat 101" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js"></script>
    <script src="../../js/perfect-scrollbar.min.js"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../../js/jquery.sticky.js"></script>
    <script src="../../js/featherlight.min.js"></script>
    <script src="../../js/html5shiv-printshiv.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js"></script>
    <script src="../../js/learn.js"></script>
    <script src="../../js/hugo-learn.js"></script>

    <link href="../../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
  </body>
</html>

